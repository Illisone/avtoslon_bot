<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ –≤ –Ω–∞–ª–∏—á–∏–∏</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–∞—Ç–∞–ª–æ–≥–∞ */
        .car-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            padding: 20px 0;
        }

        .car-card {
            background-color: var(--card-bg-blur);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .car-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5);
        }

        .car-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            /* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –æ–±–ª–∞—Å—Ç—å –±–µ–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π */
            display: block;
        }

        .car-info {
            padding: 15px;
            color: var(--text-color);
        }

        .car-title {
            font-size: 1.25em;
            margin: 0 0 5px 0;
            color: var(--accent-light);
            /* –í—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è */
        }

        .car-price {
            font-size: 1.5em;
            font-weight: 700;
            color: #fff;
            margin: 0 0 10px 0;
        }

        .car-specs {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: var(--hint-color);
            margin-top: 5px;
        }
    </style>
</head>

<body>

    <div id="preloader">
        <div class="loader"></div>
    </div>

    <div class="container">
        <header class="header">
            <h1 class="page-title">–ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –≤ –Ω–∞–ª–∏—á–∏–∏:</h1>
        </header>

        <div id="carList" class="car-list">
            </div>

        <div id="emptyState" style="text-align: center; color: var(--hint-color); padding: 50px; display: none;">
            <p>üò¥ –í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –Ω–µ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.</p>
            <p>–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞!</p>
        </div>
    </div>

    <script>
        const MINIMUM_DISPLAY_TIME = 2000;
        const startTime = Date.now();
        const carListElement = document.getElementById('carList');
        const emptyStateElement = document.getElementById('emptyState');

        function hidePreloader() {
            const preloader = document.getElementById("preloader");
            if (!preloader) return;
            const elapsedTime = Date.now() - startTime;
            const remainingTime = Math.max(0, MINIMUM_DISPLAY_TIME - elapsedTime);

            setTimeout(() => {
                preloader.classList.add("hidden");
                setTimeout(() => {
                    preloader.remove();
                }, 500);
            }, remainingTime);
        }

        // 1. –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö —É –±–æ—Ç–∞
        function requestCarData() {
            // –°–æ–æ–±—â–∞–µ–º –±–æ—Ç—É, —á—Ç–æ –º—ã —Ö–æ—Ç–∏–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ
            Telegram.sendData(JSON.stringify({
                command: 'GET_CAR_CATALOG'
            }));

            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ Telegram.sendData() –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç
            // –Ω–∞–ø—Ä—è–º—É—é. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É
            // –∏–ª–∏ –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ, –±–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
            // –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ Mini App.
            // **–ü–æ—Å–∫–æ–ª—å–∫—É –±–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é, –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
            // –ø—Ä–æ—Å—Ç–æ–π AJAX-–∑–∞–ø—Ä–æ—Å, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è, —á—Ç–æ –≤—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ
            // –æ—Ç–¥–µ–ª—å–Ω—ã–π API-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è Mini App –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è JSON.
            // –ù–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —è —Å–µ–π—á–∞—Å —Å–¥–µ–ª–∞—é –∑–∞–≥–ª—É—à–∫—É, –∏–º–∏—Ç–∏—Ä—É—é—â—É—é –æ—Ç–≤–µ—Ç.**
            
            // –ó–∞–≥–ª—É—à–∫–∞, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ API/–±–æ—Ç–∞
            // –ú—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –±–æ—Ç –∫–∞–∫–∏–º-—Ç–æ –æ–±—Ä–∞–∑–æ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç JSON.
            // –í `app.py` —è –æ–ø–∏—à—É, –∫–∞–∫ –±–æ—Ç –¥–æ–ª–∂–µ–Ω —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ.
            // –î–ª—è —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏ Mini App –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É
            // –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
            
            // **–í–ù–ò–ú–ê–ù–ò–ï: –í –†–ï–ê–õ–¨–ù–û–ú –ü–†–û–ï–ö–¢–ï –ù–£–ñ–ï–ù –°–ï–†–í–ï–†–ù–´–ô –≠–ù–î–ü–û–ò–ù–¢ –î–õ–Ø JSON!**
            // –î–ª—è —Ü–µ–ª–µ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
            fetchCarDataFromBot();
        }

        function fetchCarDataFromBot() {
             // –ò–º–∏—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏—Å–ª–∞—Ç—å –≤–∞—à —Å–µ—Ä–≤–µ—Ä/–±–æ—Ç
             const MOCK_CARS = [
                { id: 1, title: 'Geely Monjaro', price: '3 500 000 ‚ÇΩ', year: 2023, mileage: '5 000 –∫–º', photo_id: 'AgACAgIA... (Photo ID)', image_url: 'https://i.imgur.com/example1.jpg' },
                { id: 2, title: 'Toyota Camry', price: '1 950 000 ‚ÇΩ', year: 2020, mileage: '45 000 –∫–º', photo_id: 'AgACAgIA... (Photo ID)', image_url: 'https://i.imgur.com/example2.jpg' },
                { id: 3, title: 'Zeekr 001', price: '6 100 000 ‚ÇΩ', year: 2024, mileage: '500 –∫–º', photo_id: 'AgACAgIA... (Photo ID)', image_url: 'https://i.imgur.com/example3.jpg' }
             ];

             // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –±–æ—Ç–æ–º)
             const carDataJSON = localStorage.getItem('car_catalog_data');
             const cars = carDataJSON ? JSON.parse(carDataJSON) : MOCK_CARS;
             
             if (cars && cars.length > 0) {
                 renderCarList(cars);
             } else {
                 emptyStateElement.style.display = 'block';
             }
             hidePreloader(); // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–∑–∞–≥–ª—É—à–∫–∏)
        }


        // 2. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞
        function renderCarList(cars) {
            carListElement.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞
            cars.forEach(car => {
                const card = document.createElement('div');
                card.className = 'car-card';
                card.setAttribute('data-id', car.id);
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–∏–±–æ image_url (–µ—Å–ª–∏ –µ—Å—Ç—å), –ª–∏–±–æ –∑–∞–≥–ª—É—à–∫—É
                const imageUrl = car.image_url || 'https://via.placeholder.com/600x400?text=Photo+Pending';
                
                card.innerHTML = `
                    <img src="${imageUrl}" alt="${car.title}" class="car-image">
                    <div class="car-info">
                        <h2 class="car-title">${car.title}</h2>
                        <p class="car-price">${car.price}</p>
                        <div class="car-specs">
                            <span>–ì–æ–¥: ${car.year}</span>
                            <span>–ü—Ä–æ–±–µ–≥: ${car.mileage}</span>
                        </div>
                    </div>
                `;
                
                // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–µ–π
                card.addEventListener('click', () => {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –¥–ª—è car_details.html
                    localStorage.setItem('current_car_details', JSON.stringify(car));
                    // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–µ–π —Å ID –≤ URL
                    window.location.href = `car_details.html?id=${car.id}`;
                });
                
                carListElement.appendChild(card);
            });
        }
        
        // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        Telegram.WebApp.ready();
        requestCarData();
        
        window.addEventListener("load", () => {
            // –ü–æ—Å–∫–æ–ª—å–∫—É –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ requestCarData, hidePreloader
            // –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω —Ç–∞–º. –≠—Ç–∞ —á–∞—Å—Ç—å –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞, –Ω–æ –æ—Å—Ç–∞–≤–ª—é –Ω–∞ —Å–ª—É—á–∞–π
            // –º–µ–¥–ª–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä—É–≥–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤.
        });
        
    </script>

</body>

</html>